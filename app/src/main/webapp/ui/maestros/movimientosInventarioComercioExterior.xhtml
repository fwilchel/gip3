<?xml version="1.0" encoding="UTF-8"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  template="/resources/#{menuMB.tema}/template/general.xhtml">
  <ui:define 
    name="title">
    #{msg.generalTituloSOC} .::#{msg.maestroInventarioComExt_TituloFrame}::.
  </ui:define>
  <ui:define 
    name="contenido">
    <p:spacer 
      height="40"/>
    <p:tabView 
      id="tabPanel">
      <p:tab 
        id="tabMovimientosInventario"
        title="Movimientos Inventario Comercio Exterior" 
        rendered="#{inventarioComercioExteriorMB.modoLista}">
        <h:form 
          id="forma"
          prependId="false">
          <p:messages 
            id="msgs" 
            showDetail="false" 
            showSummary="true" 
            globalOnly="false"
            showIcon="true" 
            autoUpdate="true"/>  
          <p:dataTable 
            id="tblMovimientosInventario"
            widgetVar="tblMovimientosInventario" 
            value="#{inventarioComercioExteriorMB.movimientosInventario}" 
            var="dato" 
            rows="10"
            emptyMessage="#{msg.generalNoDatos}" 
            paginator="true"
            paginatorPosition="bottom" 
            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
            rowsPerPageTemplate="10,20,50,100">
            <f:facet
              name="header">
              <div align="right">
                <p:outputPanel>
                  <p:outputLabel 
                    value="#{msg.maestroInventarioComExt_SKU}" 
                    for="sku" 
                    styleClass="negrita" />
                  <p:spacer
                    height="5"/>
                  <p:inputText 
                    value="#{inventarioComercioExteriorMB.sku}" 
                    id="sku" 
                    required="false" 
                    disabled="false" 
                    label="#{msg.maestroInventarioComExt_SKU}" />
                  <p:spacer
                    height="5"/>
                  <p:commandButton 
                    value="#{msg.generalConsultar}" 
                    icon="ui-icon-search" 
                    actionListener="#{inventarioComercioExteriorMB.consultarMovimientosInventarioComExt}" 
                    update=":tabPanel:forma:tblMovimientosInventario" />
                  <p:spacer
                    height="5"/>
                  <p:commandButton 
                    action="#{inventarioComercioExteriorMB.activarModoIngresarMovimientos}" 
                    title="Ingresar movimientos"
                    icon="ui-icon-plus" 
                    value="Ingresar movimientos" 
                    update="@all"/>
                </p:outputPanel>
              </div>
            </f:facet>
            <p:column 
              filterBy="#{dato.consecutivoDocumento}" 
              headerText="#{msg.maestroInventarioComExt_Cons_Doc}"
              filterMatchMode="contains" 
              sortBy="#{dato.consecutivoDocumento}">
              <h:outputText 
                value="#{dato.consecutivoDocumento}" />
            </p:column>
            <p:column 
              filterBy="#{dato.productosInventarioComext.productosInventario.sku}" 
              headerText="#{msg.maestroInventarioComExt_SKU}"
              filterMatchMode="contains" 
              sortBy="#{dato.productosInventarioComext.productosInventario.sku}">
              <h:outputText 
                value="#{dato.productosInventarioComext.productosInventario.sku}" />
            </p:column>
            <p:column 
              filterBy="#{dato.productosInventarioComext.productosInventario.nombre}" 
              headerText="#{msg.maestroInventarioComExt_Nombre_Producto}"
              filterMatchMode="contains" 
              sortBy="#{dato.productosInventarioComext.productosInventario.nombre}">
              <h:outputText 
                value="#{dato.productosInventarioComext.productosInventario.nombre}" />
            </p:column>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_Cantidad}"
              sortBy="#{dato.cantidad}" 
              style="width:100px;" >
              <p:outputLabel 
                value="#{dato.cantidad}"  
                style="text-align:right">
                <f:convertNumber 
                  pattern="#####,###,###,##0.00" />
              </p:outputLabel>
            </p:column>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_Saldo}"
              sortBy="#{dato.saldo}" 
              style="width:100px;">
              <p:outputLabel 
                value="#{dato.saldo}"  
                style="text-align:right">
                <f:convertNumber 
                  pattern="#####,###,###,##0.00" />
              </p:outputLabel>
            </p:column>
            <p:column 
              filterBy="#{dato.tipoMovimiento.nombre}" 
              headerText="#{msg.maestroInventarioComExt_Tipo_Movimiento}"
              filterMatchMode="contains" 
              sortBy="#{dato.tipoMovimiento.nombre}">
              <h:outputText 
                value="#{dato.tipoMovimiento.nombre}" />
            </p:column>
            <p:column 
              filterBy="#{dato.fecha}"
              headerText="#{msg.maestroInventarioComExt_Fecha}"
              filterMatchMode="contains" 
              sortBy="#{dato.fecha}">
              <p:outputLabel 
                value="#{dato.fecha}" >
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy"/>
              </p:outputLabel>
            </p:column>
          </p:dataTable>
        </h:form>
      </p:tab>
      <p:tab 
        id="tabNuevosMovimientos"
        title="Ingresar Movimientos" 
        rendered="#{inventarioComercioExteriorMB.modoEditar}">
        <h:form 
          id="frmNuevosMovimientos"
          prependId="false">
          <p:messages 
            id="msgsNuevosMovimientos" 
            showDetail="false" 
            showSummary="true" 
            globalOnly="false"
            showIcon="true" 
            autoUpdate="true"/>
          <p:dataTable 
            id="tblNuevosMovimientos"
            widgetVar="tblNuevosMovimientos" 
            value="#{inventarioComercioExteriorMB.movimientosInventarioNuevos}" 
            var="dato" 
            emptyMessage="#{msg.generalNoDatos}" >
            <f:facet 
              name="header">
              <div 
                align="right">
                <p:outputPanel>
                  <p:commandButton 
                    value="Movimientos" 
                    process="@this" 
                    icon="ui-icon-circle-arrow-w" 
                    action="#{inventarioComercioExteriorMB.activarModoConsultarMovimientos()}" 
                    update="@all"/>
                  <p:commandButton 
                    value="Seleccionar productos"
                    icon="ui-icon-plus"
                    immediate="true"
                    oncomplete="PF('dlgSeleccionarProductos').show()"
                    update=":dlgSeleccionarProductos"/>
                </p:outputPanel>
              </div>
            </f:facet>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_SKU}"
              sortBy="#{dato.productosInventarioComext.productosInventario.sku}" 
              style="width:100px;">
              <h:outputText 
                value="#{dato.productosInventarioComext.productosInventario.sku}" 
                style="text-align:center;"/>
            </p:column>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_Nombre_del_producto}"
              sortBy="#{dato.productosInventarioComext.productosInventario.nombre}">
              <h:outputText 
                value="#{dato.productosInventarioComext.productosInventario.nombre}" />
            </p:column>
            <p:column 
              headerText="Tipo de movimiento"
              style="width:150px;">
              <p:selectOneMenu 
                id="tipoMovimiento" 
                required="true"
                value="#{dato.tipoMovimiento.id}"
                label="Tipo de movimiento"
                style="width:130px;"
                immediate="true">
                <p:ajax 
                  update=":tabPanel:frmNuevosMovimientos:tblNuevosMovimientos" />
                <f:selectItem 
                  itemLabel="Entrada" 
                  itemValue="1"/>
                <f:selectItem 
                  itemLabel="Salida" 
                  itemValue="2"
                  itemDisabled="#{!dato.tieneSaldo}"/>
              </p:selectOneMenu>
            </p:column>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_Cantidad}"
              style="width:150px;">  
              <p:spinner 
                id="cantidadRequerida"
                value="#{dato.cantidad}" 
                label="#{msg.ispcnTblColCantidad}"
                stepFactor="1"
                min="1"
                max="#{dato.controlarCantidad() ? dato.saldo : 999999999}"
                required="true"
                size="16"
                maxlength="9"
                style="text-align:right;">                
                <p:ajax 
                  update="cantidadRequerida" 
                  process="@this" />
              </p:spinner>
            </p:column>
            <p:column 
              headerText="#{msg.maestroInventarioComExt_Saldo}"
              style="width:150px;">
              <p:inputText  
                value="#{dato.saldo}" 
                label="#{msg.maestroInventarioComExt_Cantidad}" 
                required="true" 
                size="16"
                maxlength="9"
                disabled="true"
                style="text-align:right;">
                <f:convertNumber 
                  pattern="#####,###,###,##0.00" />
              </p:inputText>
            </p:column>
            <p:column 
              style="width:32px;text-align:center;">
              <p:commandButton 
                icon="ui-icon-trash" 
                title="#{msg.ispcnBtnRemoverProducto}"
                actionListener="#{inventarioComercioExteriorMB.eliminarMovimiento(dato)}"
                process="@this" 
                update=":tabPanel:frmNuevosMovimientos:tblNuevosMovimientos">
              </p:commandButton>
            </p:column>
            <f:facet 
              name="footer">
              <p:commandButton 
                value="#{msg.generalGuardar}" 
                icon="ui-icon-disk" 
                actionListener="#{inventarioComercioExteriorMB.guardarMovimientos}"
                update=":tabPanel:frmNuevosMovimientos:tblNuevosMovimientos"
                disabled="#{empty inventarioComercioExteriorMB.movimientosInventarioNuevos}"/>
              <p:commandButton 
                value="Limpiar" 
                process="@this" 
                icon="ui-icon-cancel"
                actionListener="#{inventarioComercioExteriorMB.reset()}"
                update=":tabPanel:frmNuevosMovimientos:tblNuevosMovimientos">
                <p:resetInput 
                  target=":tabPanel:frmNuevosMovimientos:tblNuevosMovimientos" />
              </p:commandButton>
            </f:facet>
          </p:dataTable>
        </h:form>
      </p:tab>
    </p:tabView>
    <p:dialog 
      id="dlgSeleccionarProductos"
      widgetVar="dlgSeleccionarProductos" 
      header="#{msg.maestroProductosXClienteBuscarProd}"
      modal="true" 
      showEffect="fade"
      hideEffect="fade" 
      resizable="false" 
      dynamic="true" 
      width="800"
      closable="true"
      position="top"
      closeOnEscape="true">
      <h:form 
        id="frmSeleccionarProductos">
        <p:messages 
          id="msgsSeleccionarProductos" 
          showDetail="false" 
          showSummary="true" 
          globalOnly="true"
          showIcon="true"/>
        <p:panelGrid 
          columns="2" 
          layout="grid"
          columnClasses="label,izquierda">
          <p:outputLabel 
            value="#{msg.maestroProductosXClienteCateInv}" 
            for="categoria" 
            styleClass="negrita" />
          <h:panelGroup>
            <p:selectOneMenu 
              id="categoria" 
              value="#{inventarioComercioExteriorMB.productosInventarioFiltroDTO.idCategoria}" 
              height="200" 
              label="#{msg.maestroProductosXClienteCateInv}">
              <f:selectItem 
                itemValue="-1" 
                itemLabel="#{msg.generalTodos}"/>
              <f:selectItems 
                value="#{inventarioComercioExteriorMB.categoriasInventarios}" />
            </p:selectOneMenu>
            <p:message 
              for="categoria"/>
          </h:panelGroup>
          <p:outputLabel 
            value="#{msg.maestroProductosXClienteCENombredelProducto}" 
            for="nombreProd" 
            styleClass="negrita"/>
          <h:panelGroup>
            <h:inputText 
              value="#{inventarioComercioExteriorMB.productosInventarioFiltroDTO.nombre}" 
              id="nombreProd" 
              maxlength="40" 
              label="#{msg.maestroProductosXClienteCENombredelProducto}"/>
            <p:message 
              for="nombreProd"/>
          </h:panelGroup>
          <p:outputLabel 
            value="#{msg.maestroProductosXClienteCESKU}" 
            for="sku" 
            styleClass="negrita"/>
          <h:panelGroup>
            <h:inputText 
              value="#{inventarioComercioExteriorMB.productosInventarioFiltroDTO.sku}" 
              id="sku" 
              maxlength="40" 
              label="#{msg.maestroProductosXClienteCESKU}"/>
            <p:message 
              for="sku"/>
          </h:panelGroup>
          <f:facet
            name="footer">
            <p:commandButton 
              value="#{msg.generalConsultar}" 
              icon="ui-icon-disk" 
              actionListener="#{inventarioComercioExteriorMB.buscarProductosInventarios}" 
              update=":frmSeleccionarProductos:tblProductos" />
          </f:facet>
        </p:panelGrid>
        <p:dataTable 
          id="tblProductos"
          widgetVar="tblProductos" 
          var="dato" 
          value="#{inventarioComercioExteriorMB.productos}" 
          rows="10"
          emptyMessage="#{msg.generalNoDatos}" 
          paginator="true"
          paginatorPosition="bottom"
          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
          rowsPerPageTemplate="10,20,50,100">
          <p:column 
            filterBy="#{dato.sku}" 
            headerText="#{msg.maestroInventarioComExt_SKU}"
            filterMatchMode="contains" 
            sortBy="#{dato.sku}"
            style="width:100px;">
            <h:outputText 
              value="#{dato.sku}" />
          </p:column>
          <p:column 
            filterBy="#{dato.nombre}" 
            headerText="#{msg.maestroInventarioComExt_Nombre_del_producto}"
            filterMatchMode="contains" 
            sortBy="#{dato.nombre}">
            <h:outputText 
              value="#{dato.nombre}" />
          </p:column>
          <p:column 
            style="width:32px;text-align: center">
            <p:commandButton 
              icon="ui-icon-cart" 
              title="#{msg.ispcnBtnAgregarProducto}"
              actionListener="#{inventarioComercioExteriorMB.agregarProducto(dato)}"
              process="@this" 
              update="@form :tabPanel:frmNuevosMovimientos:tblNuevosMovimientos"/>
          </p:column>
        </p:dataTable>
      </h:form>
    </p:dialog>
  </ui:define>
</ui:composition>


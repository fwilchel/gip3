<?xml version="1.0" encoding="iso-8859-1"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  template="/resources/#{menuMB.tema}/template/general.xhtml">
  <ui:define 
    name="title">
    #{msg.generalTituloSOC} .::#{msg.TituloGenerarFacturaProforma}::.
  </ui:define>
  <ui:define 
    name="contenido">
    <p:spacer 
      height="40"/>
    <p:tabView 
      id="tabPanel">
      <p:tab 
        title="#{msg.TituloGenerarFacturaProforma}">
        <h:form 
          id="forma"
          rendered="#{generarFPMB.modoLista}">
          <p:messages 
            id="msgs" 
            showDetail="false" 
            showSummary="true"
            globalOnly="false" 
            showIcon="true"/>
          <p:dataTable 
            id="tblSolicitudes"
            widgetVar="tblSolicitudes" 
            value="#{generarFPMB.listaSP}" 
            var="doc" 
            rows="10"
            paginator="true" 
            paginatorPosition="bottom"
            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
            rowsPerPageTemplate="10,20,50,100">
            <f:facet
              name="header">
              <div align="right">
                <p:outputPanel>
                  <p:outputLabel 
                    value="#{msg.IngresarNumPedidoFactura}: "
                    for="consecutivo" />
                  <p:spacer
                    height="5"/>
                  <p:inputText 
                    value="#{generarFPMB.consecutivoDocumento}"
                    id="consecutivo" 
                    required="false" />
                  <p:spacer
                    height="5"/>
                  <p:commandButton 
                    value="#{msg.documentoEjecutarBusqueda}"
                    update=":tabPanel:forma:tblSolicitudes" 
                    actionListener="#{generarFPMB.buscarSolicitudesPedidos}" />
                </p:outputPanel>
              </div>
            </f:facet>
            <p:column 
              style="width:32px;text-align: center">
              <p:commandButton 
                icon="ui-icon-zoomin"
                title="Ver"
                action="#{generarFPMB.initGeneracion(doc)}"
                update="@all"/>
            </p:column>
            <p:column 
              filterBy="#{doc.id}" 
              headerText="#{msg.CodigoGipSP}"
              filterMatchMode="contains" 
              sortBy="#{doc.id}">
              <h:outputText 
                value="#{doc.id}" />
            </p:column>
            <p:column 
              filterBy="#{doc.consecutivoDocumento}"
              headerText="#{msg.ConsecutivoSP}" 
              filterMatchMode="contains"
              sortBy="#{doc.consecutivoDocumento}">
              <h:outputText 
                value="#{doc.consecutivoDocumento}" />
            </p:column>
            <p:column 
              filterBy="#{doc.fechaGeneracion}"
              headerText="#{msg.RequisicionNombreFechaGenerado}"
              filterMatchMode="contains" 
              sortBy="#{doc.fechaGeneracion}">
              <h:outputText 
                value="#{doc.fechaGeneracion}">
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy HH:mm:ss" />
              </h:outputText>
            </p:column>
          </p:dataTable>
        </h:form>
        <h:form 
          id="frmGenerar"
          rendered="#{generarFPMB.modoGenerar}">
          <p:outputPanel 
            id="pnlGenerar" 
            style="text-align:center;">
            <p:messages 
              id="msgsGenerar" 
              showDetail="false" 
              showSummary="true"
              globalOnly="true" 
              showIcon="true"/>            
            <p:panelGrid 
              columns="4" 
              layout="grid"
              columnClasses="label,izquierda,label,izquierda">
              <p:outputLabel 
                value="#{msg.recibiProductoDcoumento}"
                for="documento" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.id}"
                id="documento"/>
              <p:outputLabel 
                value="#{msg.RequisicionNombreCons}"
                for="consecutivoDocumento" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.consecutivoDocumento}"
                id="consecutivoDocumento" />
              <p:outputLabel 
                value="#{msg.RequisicionNombreFechaGenerado}"
                for="fechaGeneracion" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.fechaGeneracion}"
                id="fechaGeneracion">
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy HH:mm:ss" />
              </h:outputText>
              <p:outputLabel 
                value="#{msg.nomCliente}" 
                for="clienteNombre"
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.cliente.nombre}"
                id="clienteNombre"/>
              <p:outputLabel 
                value="#{msg.NumeroPedidoWeb}" 
                for="clienteId"
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.documentoCliente}"
                id="clienteId" />
              <p:outputLabel 
                value="#{msg.maestroDireccionCliente}"
                for="clienteDireccion" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.cliente.direccion}"
                id="clienteDireccion"/>
              <p:outputLabel 
                value="#{msg.maestroTelefonoCliente}"
                for="clienteTelefono" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.cliente.telefono}"
                id="clienteTelefono" />
              <p:outputLabel 
                value="#{msg.maestroContactoAgente}"
                for="clienteContacto" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.cliente.contacto}"
                id="clienteContacto"/>
              <p:outputLabel 
                value="#{msg.TerminoIncotermSP}"
                for="terminoIncoterm" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.documentoXNegociacion.terminoIncoterm.descripcion}"
                id="terminoIncoterm" />
              <p:outputLabel 
                value="#{msg.LugarIncoterm}" 
                for="lugarIncoterm"
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.documentoXNegociacion.lugarIncoterm}"
                id="lugarIncoterm" />
              <p:outputLabel 
                value="#{msg.CantidadContenedores20}"
                for="cantidadContenedores20" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.documentoXNegociacion.cantidadContenedoresDe20}"
                id="cantidadContenedores20"/>
              <p:outputLabel 
                value="#{msg.CantidadContenedores40}"
                for="cantidadContenedores40" 
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.documentoXNegociacion.cantidadContenedoresDe40}"
                id="cantidadContenedores40" />
              <p:outputLabel 
                value="#{msg.FechaDespacho}" 
                for="fechaDespacho"
                styleClass="negrita" />
              <h:outputText
                value="#{generarFPMB.spSelected.fechaEsperadaEntrega}"
                id="fechaDespacho" >
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy" />
              </h:outputText>
              <p:outputLabel 
                value="#{msg.DiasVigenciaFP}" 
                for="diasVigencia"
                styleClass="negrita" />
              <h:panelGroup>
                <p:inputText 
                  value="#{generarFPMB.cantidadDiasVigencia}"
                  id="diasVigencia" 
                  label="#{msg.DiasVigenciaFP}" 
                  size="5"
                  maxlength="5"
                  disabled="false"
                  required="true" />
                <p:message 
                  for="diasVigencia" 
                  id="msgDiasVigencia"/>
              </h:panelGroup>
            </p:panelGrid>
            <p:dataTable 
              id="tablaProductos" 
              widgetVar="productoDoc"
              value="#{generarFPMB.productosSP}"
              var="producto" 
              sortBy="#{producto.idDocumento}"
              rendered="#{not empty generarFPMB.productosSP}">
              <f:facet 
                name="header">
                <div 
                  align="right">
                  <p:outputPanel
                    style="height: 15px">
                  </p:outputPanel>
                </div>
              </f:facet>
              <p:column styleClass="centro" headerText="#{msg.buscadorPxCSKU}">
                <h:outputText value="#{producto.sku}" />
              </p:column>
              <p:column headerText="#{msg.buscadorNombreProducto}">
                <h:outputText value="#{producto.nombre}" />
              </p:column>
              <p:column styleClass="derecha"
                        headerText="#{msg.comprasCantidadSola}">
                <h:outputText value="#{producto.cantidad}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha"
                        headerText="#{msg.costeoComperasValorUnitarioML}">
                <h:outputText value="#{producto.precio}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha"
                        headerText="#{msg.VentasRemisionValorTotal}">
                <h:outputText value="#{producto.valorTotal}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha" headerText="#{msg.PesoNetoVista}">
                <h:outputText value="#{producto.totalPesoNeto}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha" headerText="#{msg.PesoBrutoVista}">
                <h:outputText value="#{producto.totalPesoBruto}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha" headerText="#{msg.SPcantidadCajas}">
                <h:outputText value="#{producto.totalCajas}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha"
                        headerText="#{msg.SPcantidadTendido}">
                <h:outputText value="#{producto.totalCajasTendido}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column styleClass="derecha"
                        headerText="#{msg.SPcantidadPallet}">
                <h:outputText value="#{producto.totalCajasPallet}">
                  <f:convertNumber pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:summaryRow>
                <p:column colspan="2" styleClass="derecha">
                  <h:outputText value="TOTALES " />
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalCantidad}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalValorTotal}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalPesoNeto}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalPesoBruto}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalCantidadCajas}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText
                    value="#{generarFPMB.totalCantidadTendidos}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column styleClass="derecha">
                  <h:outputText value="#{generarFPMB.totalCantidadPallets}">
                    <f:convertNumber pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
              </p:summaryRow>
            </p:dataTable>
            <p:spacer 
              height="10"/>
            <p:panelGrid 
              columns="2">
              <p:panelGrid>
                <f:facet 
                  name="header">
                  <p:row>
                    <p:column colspan="2"></p:column>
                    <p:column>#{msg.SP_TotalCostos}</p:column>
                    <p:column>#{msg.TotalNegociacion}</p:column>
                  </p:row>
                </f:facet>
                <p:row>
                  <p:column styleClass="negrita">#{msg.SP_CostoEntrega}</p:column>
                  <p:column styleClass="derecha">
                    <h:outputLabel
                      value="#{generarFPMB.spSelected.documentoXNegociacions.get(0).costoEntrega}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                  <p:column rowspan="4" styleClass="derecha">
                    <h:outputLabel value="#{generarFPMB.totalCostos}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                  <p:column rowspan="4" styleClass="derecha">
                    <h:outputLabel value="#{generarFPMB.totalNegociacion}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                </p:row>
                <p:row>
                  <p:column styleClass="negrita">#{msg.SP_CostoSeguro}</p:column>
                  <p:column styleClass="derecha">
                    <h:outputLabel
                      value="#{generarFPMB.spSelected.documentoXNegociacions.get(0).costoSeguro}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                </p:row>
                <p:row>
                  <p:column styleClass="negrita">#{msg.SP_CostoFlete}</p:column>
                  <p:column styleClass="derecha">
                    <h:outputLabel
                      value="#{generarFPMB.spSelected.documentoXNegociacions.get(0).costoFlete}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                </p:row>
                <p:row>
                  <p:column styleClass="negrita">#{msg.SP_OtrosGastos}</p:column>
                  <p:column styleClass="derecha">
                    <h:outputLabel
                      value="#{generarFPMB.spSelected.documentoXNegociacions.get(0).otrosGastos}">
                      <f:convertNumber maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputLabel>
                  </p:column>
                </p:row>
              </p:panelGrid>
              <f:facet 
                name="footer">
                <p:commandButton 
                  id="btnGenerar"
                  value="#{msg.VentasGenerarFactura}"
                  icon="ui-icon-script" 
                  actionListener="#{generarFPMB.crearFactura}"
                  update="@all">
                </p:commandButton>
                <p:commandButton 
                  value="#{msg.generalCancelar}"
                  icon="ui-icon-cancel"
                  actionListener="#{generarFPMB.volverAlListado}"
                  immediate="true"
                  update="@all"/>
              </f:facet>
            </p:panelGrid>
          </p:outputPanel>
        </h:form>
      </p:tab>
    </p:tabView>
  </ui:define>
</ui:composition>
<?xml version="1.0" encoding="iso-8859-1"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  template="/resources/#{menuMB.tema}/template/general.xhtml">
  <ui:define 
    name="title">
    #{msg.generalTituloSOC} .::#{msg.solicitudPedidoInicio}::.
  </ui:define>
  <ui:define 
    name="contenido">
    <p:spacer 
      height="40"/>
    <p:tabView 
      id="tabPanel">
      <p:tab 
        title="#{msg.solicitudPedidoInicio}">
        <h:form 
          prependId="false" 
          id="forma"
          rendered="#{solicitudPedidoMB.renderedFormList()}">
          <p:messages 
            id="msgs" 
            showDetail="false" 
            showSummary="true"
            globalOnly="false" 
            showIcon="true"/>
          <p:spacer 
            height="20"/>
          <p:dataTable 
            id="tablaDatos"
            widgetVar="tablaDatos" 
            value="#{solicitudPedidoMB.listaSP}" 
            var="dato" 
            rows="10"
            emptyMessage="#{msg.comercioDocumentosIncotermNoEncontrados}"
            paginator="true" 
            paginatorPosition="bottom"
            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
            rowsPerPageTemplate="10,20,50,100">
            <p:column 
              style="width:32px;text-align:center">
              <p:commandButton 
                icon="ui-icon-pencil"
                title="Modificar"
                update="@all"
                action="#{solicitudPedidoMB.onEdit(dato)}"/>
            </p:column>
            <p:column 
              headerText="#{msg.recibiProductoDcoumento}"
              sortBy="#{dato.idDocumento}"
              filterBy="#{dato.idDocumento}"
              filterMatchMode="contains" 
              style="width:120px;">
              <h:outputText 
                value="#{dato.idDocumento}" />
            </p:column>
            <p:column 
              headerText="#{msg.RequisicionNombreCons}"
              sortBy="#{dato.consecutivoDocumento}"
              filterBy="#{dato.consecutivoDocumento}"
              filterMatchMode="contains"
              style="width:160px;">
              <h:outputText 
                value="#{dato.consecutivoDocumento}"  />
            </p:column>
            <p:column 
              headerText="#{msg.DocumentoClienteSP}"
              sortBy="#{dato.documentoCliente}"
              filterBy="#{dato.documentoCliente}"
              filterMatchMode="contains" >
              <h:outputText 
                value="#{dato.documentoCliente}" />
            </p:column>
            <p:column 
              headerText="#{msg.nomCliente}"
              sortBy="#{dato.clientesNombre}"
              filterBy="#{dato.clientesNombre}"
              filterMatchMode="contains" >
              <h:outputText 
                value="#{dato.clientesNombre}" />
            </p:column>
            <p:column 
              headerText="#{msg.EstadoSP}"
              sortBy="#{dato.estadoNombre}"
              filterBy="#{dato.estadoNombre}"
              filterMatchMode="contains" >
              <h:outputText 
                value="#{dato.estadoNombre}" />
            </p:column>
            <p:column 
              headerText="#{msg.RequisicionNombreFechaGenerado}"
              sortBy="#{dato.fechaGeneracion}"
              filterBy="#{dato.fechaGeneracion}"
              filterMatchMode="contains" >
              <h:outputText 
                value="#{dato.fechaGeneracion}">
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy" />
              </h:outputText>
            </p:column>
          </p:dataTable>
        </h:form>
        <h:form 
          id="formaEditar"
          rendered="#{solicitudPedidoMB.renderedFormDetail()}">
          <p:outputPanel 
            id="datoDetalle" 
            style="text-align:center;">
            <p:messages 
              id="msgs2" 
              showDetail="false" 
              showSummary="true"
              globalOnly="true" 
              showIcon="true"/>
            <p:panelGrid 
              columns="4" 
              layout="grid"
              rendered="#{not empty solicitudPedidoMB.sp}"
              columnClasses="label,izquierda,label,izquierda">
              <p:outputLabel 
                value="#{msg.recibiProductoDcoumento}" 
                for="strId"
                styleClass="negrita" 
                style="width:20%"/>
              <h:outputText 
                id="strId" 
                value="#{solicitudPedidoMB.sp.idDocumento}" 
                style="width:30%"/>                  
              <p:outputLabel 
                value="#{msg.RequisicionNombreCons}"
                for="strConsecutivo" 
                styleClass="negrita" />
              <h:outputText
                id="strConsecutivo" 
                value="#{solicitudPedidoMB.sp.consecutivoDocumento}"/>
              <p:outputLabel 
                value="#{msg.RequisicionNombreFechaGenerado}"
                for="strFechaGeneracion" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.fechaGeneracion}"
                id="strFechaGeneracion" >
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy" />
              </h:outputText>
              <p:outputLabel 
                value="#{msg.nomCliente}" 
                for="strNombreCliente"
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.clientesNombre}"
                id="strNombreCliente" />
              <p:outputLabel 
                value="#{msg.NumeroPedidoWeb}"
                for="strDocumentoCliente" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.documentoCliente}"
                id="strDocumentoCliente" />
              <p:outputLabel 
                value="#{msg.maestroDireccionCliente}"
                for="strDocumentoClienteDir" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.clientesDireccion}"
                id="strDocumentoClienteDir" />
              <p:outputLabel 
                value="#{msg.maestroTelefonoCliente}"
                for="strDocumentoClienteTel" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.clientesTelefono}"
                id="strDocumentoClienteTel" />
              <p:outputLabel 
                value="#{msg.maestroContactoAgente}"
                for="strDocumentoClienteCont" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.clientesContacto}"
                id="strDocumentoClienteCont" />
              <p:outputLabel 
                value="#{msg.observacionDocumento}"
                for="strObservacionDoc" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.observacionDocumento}"
                id="strObservacionDoc" />
              <p:outputLabel 
                value="#{msg.observacionMarcacion2}"
                for="strObservacionMar" 
                styleClass="negrita" />
              <h:outputText
                value="#{solicitudPedidoMB.sp.observacionesMarcacion2}"
                id="strObservacionMar" />
              <p:outputLabel 
                value="#{msg.TerminoIncotermSP}"
                for="idTerminoIncoterm" 
                styleClass="negrita" />
              <h:panelGroup>
                <p:selectOneMenu 
                  id="idTerminoIncoterm"
                  value="#{solicitudPedidoMB.sp.idTerminoIncoterm}"
                  label="#{msg.TerminoIncotermSP}">
                  <f:selectItem 
                    itemLabel="#{msg.generalSinSeleccionar}" />
                  <f:selectItems 
                    value="#{comunMB.obtenerTerminosInconterm(solicitudPedidoMB.sp.clientesId)}"
                    var="categoria" 
                    itemValue="#{categoria.id}"
                    itemLabel="#{categoria.descripcion}" />
                </p:selectOneMenu>
                <p:message 
                  for="idTerminoIncoterm"/>
              </h:panelGroup>
              <p:outputLabel 
                value="#{msg.LugarIncoterm}" 
                for="strLugarIncoterm"
                styleClass="negrita" />
              <h:panelGroup>
                <p:inputText 
                  maxlength="50"
                  value="#{solicitudPedidoMB.sp.lugarIncoterm}"
                  id="strLugarIncoterm" 
                  required="true"
                  label="#{msg.LugarIncoterm}" />
                <p:message 
                  for="strLugarIncoterm"/>
              </h:panelGroup>
              <p:outputLabel 
                value="#{msg.CantidadContenedores20}"
                for="dblCantidadContenedores20" 
                styleClass="negrita" />
              <h:panelGroup>
                <p:inputText 
                  maxlength="10" 
                  size="10"
                  value="#{solicitudPedidoMB.sp.cantidadContenedores20}"
                  id="dblCantidadContenedores20" 
                  required="true"
                  label="#{msg.CantidadContenedores20}">
                  <f:convertNumber 
                    maxFractionDigits="2" 
                    minFractionDigits="2" />
                </p:inputText>
                <p:message 
                  for="dblCantidadContenedores20"/>
              </h:panelGroup>
              <p:outputLabel 
                value="#{msg.CantidadContenedores40}"
                for="dblCantidadContenedores40" 
                styleClass="negrita" />
              <h:panelGroup>
                <p:inputText 
                  maxlength="10" 
                  size="10"
                  value="#{solicitudPedidoMB.sp.cantidadContenedores40}"
                  id="dblCantidadContenedores40" 
                  required="true"
                  label="#{msg.CantidadContenedores40}">
                  <f:convertNumber 
                    maxFractionDigits="2" 
                    minFractionDigits="2" />
                </p:inputText>
                <p:message 
                  for="dblCantidadContenedores40"/>
              </h:panelGroup>
              <p:outputLabel 
                value="#{msg.FechaDespacho}" 
                for="dtmFechaDespacho"
                styleClass="negrita" />
              <h:panelGroup>
                <p:calendar 
                  id="dtmFechaDespacho"
                  value="#{solicitudPedidoMB.sp.fechaEsperadaEntregaDate}"
                  required="true" 
                  pattern="yyyy-MM-dd"/>
                <p:message 
                  for="dtmFechaDespacho"/>
              </h:panelGroup>
              <p:outputLabel 
                value="#{msg.Canal}" 
                for="idUbicacion"
                styleClass="negrita" />
              <h:panelGroup>
                <p:selectOneMenu 
                  id="idUbicacion" 
                  required="true"
                  value="#{solicitudPedidoMB.sp.idUbicacionDestino}"
                  label="#{msg.Canal}">
                  <f:selectItem 
                    itemLabel="#{msg.generalSinSeleccionar}" />
                  <f:selectItems 
                    value="#{comunMB.obtenerListaUbicaciones(menuMB.usuario.id)}"
                    var="ubicacion" 
                    itemValue="#{ubicacion.id}"
                    itemLabel="#{ubicacion.nombre}" />
                </p:selectOneMenu>
                <p:message 
                  for="idUbicacion"/>
              </h:panelGroup>
            </p:panelGrid>
            <p:dataTable 
              id="tablaProductos"
              widgetVar="tablaProductos"
              var="pxd" 
              value="#{solicitudPedidoMB.productosXDocumento}"
              sortBy="#{pxd.documento.id}"
              emptyMessage="#{msg.generalNoDatos}" >
              <f:facet 
                name="header">
                <div 
                  align="right">
                  <p:outputPanel>
                    <p:commandButton 
                      value="#{msg.buscadorConsultarPrdxCli}"
                      action="#{solicitudPedidoMB.consultarOtrosProductosDelCliente}"
                      immediate="true"
                      oncomplete="PF('dlgBuscarProductos').show()"
                      update=":tabPanel:dlgBuscarProductos"/>
                  </p:outputPanel>
                </div>
              </f:facet>
              <p:column 
                headerText="#{msg.buscadorPxCSKU}"
                style="width:32px;text-align:center;">
                <h:outputText 
                  value="#{pxd.productosInventario.sku}" />
              </p:column>
              <p:column 
                headerText="#{msg.buscadorNombreProducto}"
                style="width:200px;text-align:left;">
                <h:outputText 
                  value="#{pxd.productosInventario.nombre}" />
              </p:column>
              <p:column 
                headerText="#{msg.comprasCantidadSola}"
                style="text-align:right">
                <p:inputText 
                  id="cantidadProd1"
                  value="#{pxd.cantidad1}"
                  required="true" 
                  maxlength="10" 
                  size="10" 
                  label="Cantidad"
                  style="text-align:right">
                  <p:ajax 
                    event="blur" 
                    listener="#{solicitudPedidoMB.recalcularTotales()}"
                    update=":tabPanel:formaEditar:tablaProductos" />
                  <f:convertNumber 
                    maxFractionDigits="2" />
                </p:inputText>
                <p:message 
                  for="cantidadProd1"/>
              </p:column>
              <p:column 
                headerText="#{msg.costeoComperasValorUnitarioML}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.valorUnitarioUsd}">
                  <f:convertNumber 
                    pattern="$#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.VentasRemisionValorTotal}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.valorTotal}">
                  <f:convertNumber 
                    pattern="$#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.PesoNetoVista}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.totalPesoNetoItem}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.PesoBrutoVista}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.totalPesoBrutoItem}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadCajas}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.cantidadCajasItem}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadTendido}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.cantidadXEmbalaje}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadPallet}"
                style="text-align:right">
                <h:outputText 
                  value="#{pxd.cantidadPalletsItem}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                style="width:32px;text-align:center;">
                <p:commandButton 
                  icon="ui-icon-trash" 
                  title="#{msg.ispcnBtnRemoverProducto}"
                  actionListener="#{solicitudPedidoMB.eliminarProducto(pxd)}"
                  process="@this" 
                  update=":tabPanel:formaEditar:tablaProductos">
                  <!--                  <p:confirm 
                                      header="#{msg.generalConfirmacion}" 
                                      message="#{msg.generalConfirmarEliminar}" 
                                      icon="ui-icon-alert"/>-->
                </p:commandButton>
              </p:column>
              <p:summaryRow 
                rendered="true">
                <p:column
                  colspan="2"
                  style="text-align:left">
                  <p:commandButton 
                    value="#{msg.generarOrdenCompraTotalizar}"
                    actionListener="#{solicitudPedidoMB.recalcularTotales()}" 
                    update=":tabPanel:formaEditar:tablaProductos" 
                    process=":tabPanel:formaEditar:tablaProductos"
                    rendered="#{not empty solicitudPedidoMB.sp}"/> 
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalCantidad}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalValorTotal}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalPesoNeto}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalPesoBruto}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalCantidadCajas}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalCantidadTendidos}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalCantidadPallets}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:center">
                </p:column>
              </p:summaryRow>
              <f:facet
                name="footer">
                <p:commandButton 
                  value="Guardar Ajustes SP" 
                  icon="ui-icon-disk"
                  action="#{solicitudPedidoMB.guardarAjustesSP}"
                  update="@all"
                  rendered="#{not empty solicitudPedidoMB.sp}"/>
                <p:commandButton 
                  value="#{msg.generalCancelar}"
                  icon="ui-icon-cancel"
                  action="#{solicitudPedidoMB.backToList}"
                  immediate="true"
                  update="@all"/>
              </f:facet>
            </p:dataTable>
          </p:outputPanel>
        </h:form>
        <p:dialog 
          id="dlgBuscarProductos"
          widgetVar="dlgBuscarProductos" 
          header="Seleccionar productos"
          modal="true" 
          showEffect="fade"
          hideEffect="fade" 
          resizable="false" 
          dynamic="true" 
          width="800"
          closable="true"
          position="top"
          closeOnEscape="true">
          <p:ajax 
            event="close" 
            update=":tabPanel:formaEditar:tablaProductos"/>
          <h:form
            id="formBuscarProductos"
            prependId="false">
            <p:dataTable 
              id="tablaProd"
              widgetVar="prodTabla" 
              var="pxc" 
              value="#{solicitudPedidoMB.productosXCliente}" 
              rows="10"
              emptyMessage="No hay productos asociados al cliente"
              paginator="true" 
              paginatorPosition="bottom"
              paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
              rowsPerPageTemplate="10,20,50,100">
              <p:column 
                headerText="#{msg.buscadorPxCSKU}"
                sortBy="#{pxc.productosInventario.sku}"
                filterBy="#{pxc.productosInventario.sku}"
                filterMatchMode="contains" 
                style="width:100px;">
                <h:outputText 
                  value="#{pxc.productosInventario.sku}" />
              </p:column>
              <p:column 
                headerText="#{msg.buscadorNombreProducto}"
                sortBy="#{pxc.productosInventario.nombre}"
                filterBy="#{pxc.productosInventario.nombre}"
                filterMatchMode="contains">
                <h:outputText 
                  value="#{pxc.productosInventario.nombre}" />
              </p:column>
              <p:column 
                style="width:32px;text-align: center">
                <p:commandButton 
                  icon="ui-icon-cart" 
                  title="#{msg.ispcnBtnAgregarProducto}"
                  actionListener="#{solicitudPedidoMB.agregarProducto(pxc)}"
                  process="@this" 
                  update=":tabPanel:formaEditar:tablaProductos @form "/>
              </p:column>
            </p:dataTable>
          </h:form>          
        </p:dialog>
      </p:tab>
    </p:tabView>
  </ui:define>
</ui:composition>
<?xml version="1.0" encoding="iso-8859-1"?>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  template="/resources/#{menuMB.tema}/template/general.xhtml">
  <ui:define 
    name="title">
    #{msg.generalTituloSOC} .::#{msg.solicitudPedidoInicio}::.
  </ui:define>
  <ui:define 
    name="contenido">
    <p:spacer 
      height="40"/>
    <p:tabView 
      id="tabPanel">
      <p:tab 
        title="#{msg.solicitudPedidoInicio}">
        <h:form 
          prependId="false" 
          id="forma"
          rendered="#{solicitudPedidoMB.renderedFormList()}">
          <p:messages 
            id="msgs" 
            showDetail="false" 
            showSummary="true"
            globalOnly="false" 
            showIcon="true"/>
          <p:spacer 
            height="20"/>
          <p:dataTable 
            var="dato" 
            widgetVar="datoTabla" 
            id="tablaDatos"
            value="#{solicitudPedidoMB.listaDocumentos}" 
            rows="10"
            emptyMessage="#{msg.comercioDocumentosIncotermNoEncontrados}"
            paginator="true" 
            paginatorPosition="bottom"
            paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
            rowsPerPageTemplate="5,10,15">
            <p:column 
              style="width:32px;text-align: center">
              <p:commandButton 
                icon="ui-icon-pencil"
                update="@all"
                action="#{solicitudPedidoMB.consultarSolicitudPedido}">
                <f:setPropertyActionListener 
                  value="#{dato}"
                  target="#{solicitudPedidoMB.seleccionado}" />
              </p:commandButton>
            </p:column>
            <p:column 
              headerText="#{msg.recibiProductoDcoumento}">
              <h:outputText 
                value="#{dato.idDocumento}" />
            </p:column>
            <p:column 
              headerText="#{msg.RequisicionNombreCons}">
              <h:outputText 
                value="#{dato.consecutivoDocumento}" />
            </p:column>
            <p:column 
              headerText="#{msg.DocumentoClienteSP}">
              <h:outputText 
                value="#{dato.documentoCliente}" />
            </p:column>
            <p:column 
              headerText="#{msg.nomCliente}">
              <h:outputText 
                value="#{dato.clientesNombre}" />
            </p:column>
            <p:column 
              headerText="#{msg.EstadoSP}">
              <h:outputText 
                value="#{dato.estadoNombre}" />
            </p:column>
            <p:column 
              headerText="#{msg.RequisicionNombreFechaGenerado}">
              <h:outputText 
                value="#{dato.fechaGeneracion}">
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy" />
              </h:outputText>
            </p:column>
          </p:dataTable>
        </h:form>
        <h:form 
          id="formaEditar"
          rendered="#{solicitudPedidoMB.renderedFormDetail()}">
          <p:outputPanel 
            id="datoDetalle" 
            style="text-align:center;">
            <p:messages 
              id="msgs2" 
              showDetail="false" 
              showSummary="true"
              globalOnly="true" 
              showIcon="true"/>
            <p:panelGrid 
              columns="6"
              rendered="#{not empty solicitudPedidoMB.seleccionado}"
              columnClasses="label,value,,label,value,">
              <p:outputLabel 
                value="#{msg.recibiProductoDcoumento}" 
                for="strId"
                styleClass="negrita" />
              <h:inputText 
                value="#{solicitudPedidoMB.seleccionado.idDocumento}"
                id="strId" 
                disabled="true" 
                label="#{msg.recibiProductoDcoumento}" />
              <p:message 
                for="strId"/>
              <p:outputLabel 
                value="#{msg.RequisicionNombreCons}"
                for="strConsecutivo" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.consecutivoDocumento}"
                id="strConsecutivo" 
                disabled="true"
                label="#{msg.RequisicionNombreCons}" />
              <p:message 
                for="strConsecutivo"/>
              <p:outputLabel 
                value="#{msg.RequisicionNombreFechaGenerado}"
                for="strFechaGeneracion" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.fechaGeneracion}"
                id="strFechaGeneracion" 
                disabled="true"
                label="#{msg.RequisicionNombreFechaGenerado}">
                <f:convertDateTime 
                  pattern="dd-MMM-yyyy" />
              </h:inputText>
              <p:message 
                for="strFechaGeneracion"/>
              <p:outputLabel 
                value="#{msg.nomCliente}" 
                for="strNombreCliente"
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.clientesNombre}"
                id="strNombreCliente" 
                disabled="true" 
                label="#{msg.nomCliente}" />
              <p:message 
                for="strNombreCliente"/>
              <p:outputLabel 
                value="#{msg.NumeroPedidoWeb}"
                for="strDocumentoCliente" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.documentoCliente}"
                id="strDocumentoCliente" 
                disabled="true"
                label="#{msg.NumeroPedidoWeb}" />
              <p:message 
                for="strDocumentoCliente"/>
              <p:outputLabel 
                value="#{msg.maestroDireccionCliente}"
                for="strDocumentoClienteDir" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.clientesDireccion}"
                id="strDocumentoClienteDir" 
                disabled="true"
                label="#{msg.maestroDireccionCliente}" />
              <p:message 
                for="strDocumentoClienteDir"/>
              <p:outputLabel 
                value="#{msg.maestroTelefonoCliente}"
                for="strDocumentoClienteTel" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.clientesTelefono}"
                id="strDocumentoClienteTel" 
                disabled="true"
                label="#{msg.maestroTelefonoCliente}" />
              <p:message 
                for="strDocumentoClienteTel"/>
              <p:outputLabel 
                value="#{msg.maestroContactoAgente}"
                for="strDocumentoClienteCont" 
                styleClass="negrita" />
              <h:inputText
                value="#{solicitudPedidoMB.seleccionado.clientesContacto}"
                id="strDocumentoClienteCont" 
                disabled="true"
                label="#{msg.maestroContactoAgente}" />
              <p:message 
                for="strDocumentoClienteCont"/>
              <p:outputLabel 
                value="#{msg.observacionDocumento}"
                for="strObservacionDoc" 
                styleClass="negrita" />
              <h:inputTextarea
                value="#{solicitudPedidoMB.seleccionado.observacionDocumento}"
                id="strObservacionDoc" 
                readonly="true" 
                rows="4" 
                cols="40"
                label="#{msg.observacionDocumento}" />
              <p:message 
                for="strObservacionDoc"/>
              <p:outputLabel 
                value="#{msg.observacionMarcacion2}"
                for="strObservacionMar" 
                styleClass="negrita" />
              <h:inputTextarea
                value="#{solicitudPedidoMB.seleccionado.observacionesMarcacion2}"
                id="strObservacionMar" 
                readonly="true" 
                rows="4" 
                cols="40"
                label="#{msg.observacionMarcacion2}" />
              <p:message 
                for="strObservacionMar"/>
              <p:outputLabel 
                value="#{msg.TerminoIncotermSP}"
                for="idTerminoIncoterm" 
                styleClass="negrita" />
              <p:selectOneMenu 
                id="idTerminoIncoterm"
                value="#{solicitudPedidoMB.seleccionado.idTerminoIncoterm}"
                label="#{msg.TerminoIncotermSP}">
                <f:selectItem 
                  itemLabel="#{msg.generalSinSeleccionar}" />
                <f:selectItems 
                  value="#{solicitudPedidoMB.listaTerminoInconterm}"
                  var="categoria" 
                  itemValue="#{categoria.id}"
                  itemLabel="#{categoria.descripcion}" />
              </p:selectOneMenu>
              <p:message 
                for="idTerminoIncoterm"/>
              <p:outputLabel 
                value="#{msg.LugarIncoterm}" 
                for="strLugarIncoterm"
                styleClass="negrita" />
              <h:inputText 
                maxlength="50"
                value="#{solicitudPedidoMB.seleccionado.lugarIncoterm}"
                id="strLugarIncoterm" 
                required="true"
                label="#{msg.LugarIncoterm}" />
              <p:message 
                for="strLugarIncoterm"/>
              <p:outputLabel 
                value="#{msg.CantidadContenedores20}"
                for="dblCantidadContenedores20" 
                styleClass="negrita" />
              <h:inputText 
                maxlength="10" 
                size="10"
                value="#{solicitudPedidoMB.seleccionado.cantidadContenedores20}"
                id="dblCantidadContenedores20" 
                required="true"
                label="#{msg.CantidadContenedores20}">
                <f:convertNumber 
                  maxFractionDigits="2" 
                  minFractionDigits="2" />
              </h:inputText>
              <p:message 
                for="dblCantidadContenedores20"/>
              <p:outputLabel 
                value="#{msg.CantidadContenedores40}"
                for="dblCantidadContenedores40" 
                styleClass="negrita" />
              <h:inputText 
                maxlength="10" 
                size="10"
                value="#{solicitudPedidoMB.seleccionado.cantidadContenedores40}"
                id="dblCantidadContenedores40" 
                required="true"
                label="#{msg.CantidadContenedores40}">
                <f:convertNumber 
                  maxFractionDigits="2" 
                  minFractionDigits="2" />
              </h:inputText>
              <p:message 
                for="dblCantidadContenedores40"/>
              <p:outputLabel 
                value="#{msg.FechaDespacho}" 
                for="dtmFechaDespacho"
                styleClass="negrita" />
              <p:calendar 
                id="dtmFechaDespacho"
                value="#{solicitudPedidoMB.seleccionado.fechaEsperadaEntregaDate}"
                required="true" 
                pattern="yyyy-MM-dd"/>
              <p:message 
                for="dtmFechaDespacho"/>
              <p:outputLabel 
                value="#{msg.Canal}" 
                for="idUbicacion"
                styleClass="negrita" />
              <p:selectOneMenu 
                id="idUbicacion" 
                required="true"
                value="#{solicitudPedidoMB.seleccionado.idUbicacionDestino}"
                label="#{msg.Canal}">
                <f:selectItem 
                  itemLabel="#{msg.generalSinSeleccionar}" />
                <f:selectItems 
                  value="#{solicitudPedidoMB.listaUbicaciones}"
                  var="ubicacion" 
                  itemValue="#{ubicacion.id}"
                  itemLabel="#{ubicacion.nombre}" />
              </p:selectOneMenu>
              <p:message 
                for="idUbicacion"/>
            </p:panelGrid>
            <p:dataTable 
              id="tablaProductos"
              var="producto" 
              widgetVar="productoTabla"
              value="#{solicitudPedidoMB.listaSolicitudPedido}"
              sortBy="#{producto.intIdCliente}"
              emptyMessage="No se encontraron productos" >
              <f:facet 
                name="header">
                <div 
                  align="right">
                  <p:outputPanel>
                    <p:commandButton 
                      value="#{msg.buscadorConsultarPrdxCli}"
                      action="#{solicitudPedidoMB.consultarListaProductosxCli}"
                      immediate="true"
                      oncomplete="PF('dlgBuscarProductos').show()"
                      update=":tabPanel:dlgBuscarProductos"/>
                  </p:outputPanel>
                </div>
              </f:facet>
              <p:column 
                headerText="#{msg.buscadorPxCSKU}">
                <h:outputText 
                  value="#{producto.strSkuProductoInventario}" />
              </p:column>
              <p:column 
                headerText="#{msg.buscadorNombreProducto}">
                <h:outputText 
                  value="#{producto.strNombreProductoInventario}" />
              </p:column>
              <p:column 
                headerText="#{msg.comprasCantidadSola}"
                style="text-align:right">
                <h:inputText 
                  id="cantidadProd1"
                  value="#{producto.dblCantidad1ProductoxDocumento}"
                  required="true" 
                  maxlength="10" 
                  size="10" 
                  label="Cantidad"
                  style="text-align:right">
                  <f:convertNumber 
                    maxFractionDigits="2" />
                </h:inputText>
                <p:message 
                  for="cantidadProd1"/>
              </p:column>
              <p:column 
                headerText="#{msg.costeoComperasValorUnitarioML}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblPrecioUSD}">
                  <f:convertNumber 
                    pattern="$#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.VentasRemisionValorTotal}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblValorTotalProductoxDocumento}">
                  <f:convertNumber 
                    pattern="$#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.PesoNetoVista}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblTotalPesoNeto}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.PesoBrutoVista}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblTotalPesoBruto}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadCajas}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblTotalCajas}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadTendido}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblTotalCajasTendido}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.SPcantidadPallet}"
                style="text-align:right">
                <h:outputText 
                  value="#{producto.dblTotalCajasPallet}">
                  <f:convertNumber 
                    pattern="#####,###,###,##0.00" />
                </h:outputText>
              </p:column>
              <p:column 
                headerText="#{msg.buscadorIncluirProducto}"
                style="text-align:center">
                <p:selectBooleanCheckbox 
                  value="#{producto.blnIncluirBusqueda}" />
              </p:column>
              <p:summaryRow 
                rendered="true">
                <p:column
                  colspan="2"
                  style="text-align:left">
                  <h:outputText 
                    value="Totales:" />
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.cantidadValorT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.totalValorT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.valorPesoNetoT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.valorPesoBrutoT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.valorCajasT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.valorCajasTendidoT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:right">
                  <h:outputText 
                    value="#{solicitudPedidoMB.valorCajasPalletT}">
                    <f:convertNumber 
                      pattern="#####,###,###,##0.00" />
                  </h:outputText>
                </p:column>
                <p:column
                  style="text-align:center">
                  <p:commandButton 
                    value="#{msg.generarOrdenCompraTotalizar}"
                    actionListener="#{solicitudPedidoMB.refrescarTotales}" 
                    update=":tabPanel:formaEditar:datoDetalle" 
                    process=":tabPanel:formaEditar:tablaProductos"
                    rendered="#{not empty solicitudPedidoMB.seleccionado}"/> 
                </p:column>
              </p:summaryRow>
            </p:dataTable>
            <p:panelGrid 
              columns="2"
              rendered="#{not empty solicitudPedidoMB.seleccionado}"
              columnClasses="label,value">
              <p:commandButton 
                value="Guardar Ajustes SP" 
                icon="ui-icon-disk"
                action="#{solicitudPedidoMB.guardarAjustesSP}"
                update=":tabPanel:formaEditar:datoDetalle, :tabPanel:forma:tablaDatos"/>
              <p:commandButton 
                value="#{msg.generalVolverLista}"
                icon="ui-icon-cancel"
                action="#{solicitudPedidoMB.backToList}"
                immediate="true"
                update="@all"/>
            </p:panelGrid>
          </p:outputPanel>
        </h:form>
        <p:dialog 
          id="dlgBuscarProductos"
          widgetVar="dlgBuscarProductos" 
          header="Seleccionar productos"
          modal="true" 
          showEffect="fade"
          hideEffect="fade" 
          resizable="false" 
          dynamic="true" 
          width="800">
          <h:form
            id="formBuscarProductos"
            prependId="false">
            <p:dataTable 
              var="prod" 
              widgetVar="prodTabla" 
              id="tablaProd"
              value="#{solicitudPedidoMB.listaProductosMostrarUno}" 
              rows="10"
              emptyMessage="No hay productos asociados al cliente"
              paginator="true" 
              paginatorPosition="bottom"
              paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
              rowsPerPageTemplate="5,10,15">
              <p:column 
                headerText="#{msg.buscadorPxCSKU}"
              	sortBy="#{prod.strSkuProductoInventario}"
                filterBy="#{prod.strSkuProductoInventario}"
                filterMatchMode="contains">
                <h:outputText 
                  value="#{prod.strSkuProductoInventario}" />
              </p:column>
              <p:column 
                headerText="#{msg.buscadorNombreProducto}"
              	sortBy="#{prod.strNombreProductoInventario}"
                filterBy="#{prod.strNombreProductoInventario}"
                filterMatchMode="contains">
                <h:outputText 
                  value="#{prod.strNombreProductoInventario}" />
              </p:column>
              <p:column 
                headerText="#{msg.buscadorIncluirProducto}"
                style="width:50px;text-align: center">
                <p:selectBooleanCheckbox 
                  value="#{prod.blnIncluirBusqueda}" />
              </p:column>
              <f:facet
                name="footer">
                <p:commandButton
                  value="#{msg.buscadorInsertarProductoSeleccionado}"
                  action="#{solicitudPedidoMB.insertarProductoTabla}"
                  immediate="true"
                  update=":tabPanel:formaEditar:datoDetalle"/>
              </f:facet>
            </p:dataTable>
          </h:form>          
        </p:dialog>
      </p:tab>
    </p:tabView>
  </ui:define>
</ui:composition>